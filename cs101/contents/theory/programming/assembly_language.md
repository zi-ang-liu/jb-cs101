# アセンブリ言語

機械語をより人間に理解しやすい形で記述したものがアセンブリ言語である。**アセンブリ言語**（Assembly Language）は、機械語命令に人間が理解しやすい符号を付ける。その符号を**ニーモニック**（mnemonic）と呼ぶ。

> ニーモニックコード:
> 
> 機械語の命令を，人間に分かりやすいよう英単語や略記，10進法数字などに置き換えて表したもの。
> -- 大辞林（第２版）

例えば、機械語で`C0009A`という命令があったとすると、アセンブリ言語では`LDWA 0x0009A`のように記述する。ここで、`LDWA`は「ワードをレジスタAにロードする」という意味のニーモニックである。

コンピューターが直接理解できるのは機械語であるため、アセンブリー言語で記述されたソースコードをアセンブラ（Assembler）と呼ばれるプログラムを使って機械語に変換する必要がある。

```{mermaid}
flowchart LR
   アセンブリ言語 --> アセンブラ
   アセンブラ --> 機械語
```

## Pep/9アセンブリ言語

ここでは、Pep/9アセンブリ言語を学び、アセンブリ言語でのプログラミングを体験する。

Pep/9アセンブリ言語では、命令部のオペコードをニーモニックで表現する。オペランド部は、16進数で書き、先頭に`0x`を付ける。オペランド部の後ろに、`i`や`d`などのアルファベットを付けることで、アドレス指定方式を示す。

以下はPep/9アセンブリ言語のアドレス指定方式の一部である。

| アドレス指定方式 | 意味             |
| ---------------- | ---------------- |
| `i`              | 即値アドレス指定 |
| `d`              | 直接アドレス指定 |

以下はPep/9アセンブリ言語の命令部の一部である。

| mnemonic | 意味                          |
| -------- | ----------------------------- |
| STOP     | 実行を停止する                |
| LDWA     | レジスタAにワードをロードする |
| LDBA     | レジスタAにバイトをロードする |
| STWA     | ワードをメモリにストアする    |
| STBA     | バイトをメモリにストアする    |
| ADDA     | レジスタAに加算する           |
| SUBA     | レジスタAから減算する         |

例えば、`LDWA 0x0009A,i`は、レジスタAに`0009A`をロードする命令を表す。

- `LDWA`：レジスタAにワードをロードする
- `0x0009A`：オペランド部
- `i`：即値アドレス指定

`LDWA 0x0009A,d`は、レジスタAにメモリのアドレス`0009A`に格納されているワードをロードする命令を表す。

`ADDA 0x0009A,i`は、レジスタAに`0009A`を加算する命令を表す。

`ADDA 0x0009A,d`は、レジスタAにメモリのアドレス`0009A`に格納されているワードを加算する命令を表す。

:::{note}
`STWA`や`STBA`は、即値アドレス指定`i`を使用することはできない。
:::

## 「Hi」を出力するPep/9の機械語プログラム

以下は、Pep/9アセンブリ言語で「Hi」を出力するプログラムの例である。

```assembly
LDBA 0x0048,i  ; レジスタAに'H'のASCIIコードをロード
STBA 0xFC16,d  ; レジスタAの値をターミナルに出力
LDBA 0x0069,i  ; レジスタAに'i'のASCIIコードをロード
STBA 0xFC16,d  ; レジスタAの値をターミナルに出力
STOP           ; プログラムを停止
.END
```
