# 機械語

コンピューターが直接理解し、処理できる言語は**機械語**（Machine Language）という。プログラム内蔵方式を実現するため、機械語は0と1のビット列で表現される。

CPUでは、事前に定義された**命令セットアーキテクチャ**（ISA）に基づいて、機械語の命令を解釈し、実行する。各命令は、特定の操作を指示するビットパターンで構成されている。

コンピューターで処理するすべてのプログラムは、最終的には機械語に変換され、事前に定義された命令セットに従って実行される。

## ISAの種類

- **RISC**（Reduced Instruction Set Computer）：単純な命令を持つ。TV、スマートフォンなどでよく使用されるARMのプロセッサがその代表例。
- **CISC**（Complex Instruction Set Computer）：複雑な命令を持つ。消費電力が高い。PCでよく使用されるIntelやAMDのプロセッサがその代表例。


## Pep/9

CPUの種類によって、処理する命令セットは異なる。ここでは、Pep/9という仮想コンピューターを使って、機械語を体験する。

Pep/9のワードは、16ビット（2バイト）で構成される。

:::{note}
**ワード**（Word）とは、コンピューターの内部で一度に処理される情報量の単位である。1ワードを構成するビット数でその大きさを表す。ワードはコンピューターによって異なり、一般的には8・16・32・64ビットなどがある。
:::

Pep/9の記憶装置は、65536バイトで構成され、アドレスは`0000`から`FFFF`までの範囲で指定される。下記の表は、Pep/9の記憶装置でのアドレスと格納されるビットパターンの例である。

| アドレス | 内容        |
| -------- | ----------- |
| `0000`   | `0000 1010` |
| `0001`   | `0000 0010` |
| ...      | ...         |
| `FFFF`   | `1001 1011` |

Pep/9では、7つのレジスタを持つ。以下は三つの主要なレジスタの説明である。

- The Accumulator（A）：演算の結果を一時的に保存するレジスタ。
- The Program Counter（PC）：次に実行する命令のアドレスを指すレジスタ。
- The Instruction Register（IR）：現在実行中の命令を保持するレジスタ。

### 命令

Pep/9の命令セットには40種類の命令がある。

#### 命令部とオペランド部

命令は、**命令部**（Instruction Specifier）と**オペランド部**（Operand Specifier）の2つの部分で構成される。命令部は、命令の種類を示す8ビットのビットパターンである。オペランド部は、命令が操作するデータのアドレスや値を示す16ビットのビットパターンである。そのため、Pep/9の命令は、合計24ビット（3バイト）で表現される。

また、命令部だけで構成される命令もある。これらの命令は、オペランド部を持たないため、8ビットで表現される。

:::{figure-md} pep9_instruction_format
<img src="./image/pep9_instruction_format.drawio.svg" alt="Pep/9 Instruction Format" width="300px">

Pep/9の命令
:::

#### 命令部

命令部は以下の3つの部分で構成される。

- **オペコード**（Opcode, Operation Code）：命令の種類を示すビットパターン。
- **レジスタ指定子**（Register Specifier）：操作対象のレジスタを指定するビット。
- **アドレス指定方式**（Addressing Mode）：オペランドの指定方法を示すビット。

下では、Pep/9の命令セットの一部を紹介する。

| 命令        | 説明                         |
| ----------- | ---------------------------- |
| `0000 0000` | 実行を停止する               |
| `1100 raaa` | メモリからワードをロードする |
| `1101 raaa` | メモリからバイトをロードする |
| `1110 raaa` | メモリにワードを格納する     |
| `1111 raaa` | メモリにバイトを格納する     |
| `0110 raaa` | オペランドを加算する         |
| `0111 raaa` | オペランドを減算する         |

例えば、`0000 0000`は、実行を停止する命令であり、オペコードだけで構成される。

ここで示した他の命令は、4ビットのオペコードと、1ビットのレジスタ指定子、3ビットのアドレス指定方式を持つ。

:::{figure-md} pep9_instruction
<img src="./image/pep9_ins.drawio.svg" alt="Pep/9 Instruction" width="300px">

Pep/9のinstruction specifier
:::


| r   | レジスタ          |
| --- | ----------------- |
| 0   | Accumulator, A    |
| 1   | Index register, X |

<!-- Pep/9の命令は、**instruction specifier**と**operand specifier**の2つの部分で構成される。instruction specifierは8ビットのビットパターンで、特定の命令を示す。operand specifierは、16ビットのビットパターンで、命令が操作するデータのアドレスや値を示す。



下記の表は、Pep/9のoperation code（opcode、オペコード）とその説明である。これらのopcodeはすべて4ビットのビットパターンで表される。

| Opcode  | 説明                 |
| ------- | -------------------- |
| `0000`  | 実行を停止する       |
| `1100 ` | ワードをロードする   |
| `1101`  | バイトをロードする   |
| `1110`  | ワードを格納する     |
| `1111`  | バイトを格納する     |
| `0110`  | オペランドを加算する |
| `0111`  | オペランドを減算する |

:::{note}
ここで紹介するopcodeは、4ビットのビットパターンで表されるが、Pep/9では8ビットで構成されるopcodeもある。
:::

opcodeの後に続くregister specifierは、操作対象のレジスタを指定する。ここでは、`0`を用いてレジスタAを指定する。

アドレス指定方式（addressing mode）は、データを指定する方法を示す。アドレス指定方式には、以下の二つを紹介する。

- **即値アドレス指定**（Immediate Addressing）：オペランドの値を直接指定する。Pep/9では、`000`で即値アドレス指定を示す。
- **直接アドレス指定**（Direct Addressing）：オペランドのアドレスを直接指定する。Pep/9では、`001`で直接アドレス指定を示す。

Example

下の命令は

- opcode: `1100`
- register specifier: `0`
- addressing mode: `000`
- operand specifier: `0000 0000 0000 0000` -->