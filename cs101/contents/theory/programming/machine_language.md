# 機械語

コンピューターが直接理解し、処理できる言語は**機械語**（Machine Language）という。プログラム内蔵方式を実現するため、機械語は0と1のビット列で表現される。

CPUでは、事前に定義された**命令セットアーキテクチャ**（ISA）に基づいて、機械語の命令を解釈し、実行する。各命令は、特定の操作を指示するビットパターンで構成されている。

コンピューターで処理するすべてのプログラムは、最終的には機械語に変換され、事前に定義された命令セットに従って実行される。

## ISAの種類

- **RISC**（Reduced Instruction Set Computer）：単純な命令を持つ。TV、スマートフォンなどでよく使用されるARMのプロセッサがその代表例。
- **CISC**（Complex Instruction Set Computer）：複雑な命令を持つ。消費電力が高い。PCでよく使用されるIntelやAMDのプロセッサがその代表例。


## Pep/9

CPUの種類によって、処理する命令セットは異なる。ここでは、Pep/9という仮想コンピューターを使って、機械語を体験する。

Pep/9のワードは、16ビット（2バイト）で構成される。

:::{note}
**ワード**（Word）とは、コンピューターの内部で一度に処理される情報量の単位である。1ワードを構成するビット数でその大きさを表す。ワードはコンピューターによって異なり、一般的には8・16・32・64ビットなどがある。
:::

Pep/9の記憶装置は、65536バイトで構成され、アドレスは`0000`から`FFFF`までの範囲で指定される。下記の表は、Pep/9の記憶装置でのアドレスと格納されるビットパターンの例である。

| アドレス | 内容        |
| -------- | ----------- |
| `0000`   | `0000 1010` |
| `0001`   | `0000 0010` |
| ...      | ...         |
| `FFFF`   | `1001 1011` |

Pep/9では、7つのレジスタを持つ。以下は三つの主要なレジスタの説明である。

- The Accumulator（A）：演算の結果を一時的に保存するレジスタ。
- The Program Counter（PC）：次に実行する命令のアドレスを指すレジスタ。
- The Instruction Register（IR）：現在実行中の命令を保持するレジスタ。

### 命令

Pep/9の命令セットには40種類の命令がある。

Pep/9の命令は、**instruction specifier**と**operand specifier**の2つの部分で構成される。instruction specifierは8ビットのビットパターンで、特定の命令を示す。operand specifierは、16ビットのビットパターンで、命令が操作するデータのアドレスや値を示す。

:::{figure-md} pep9_instruction
<img src="./image/pep9_ins.drawio.svg" alt="Pep/9 Instruction" width="300px">

Pep/9のinstruction specifier
:::

下記の表は、Pep/9のoperation code（opcode、オペコード）とその説明である。これらのopcodeはすべて4ビットのビットパターンで表される。

| Opcode  | 説明                             |
| ------- | -------------------------------- |
| `0000`  | 実行を停止する                   |
| `1100 ` | レジスタにワードをロードする     |
| `1101`  | レジスタにバイトをロードする     |
| `1110`  | レジスタからワードを格納する     |
| `1111`  | レジスタからバイトを格納する     |
| `0110`  | レジスタにオペランドを加算する   |
| `0111`  | レジスタからオペランドを減算する |

:::{note}
ここで紹介するopcodeは、4ビットのビットパターンで表されるが、Pep/9では8ビットで構成されるopcodeもある。
:::

opcodeの後に続くregister specifierは、操作対象のレジスタを指定する。ここでは、`0`を用いてレジスタAを指定する。

アドレス指定方式（addressing mode）は、データを指定する方法を示す。アドレス指定方式には、以下の二つを紹介する。

- **即値アドレス指定**（Immediate Addressing）：オペランドの値を直接指定する。Pep/9では、`000`で即値アドレス指定を示す。
- **直接アドレス指定**（Direct Addressing）：オペランドのアドレスを直接指定する。Pep/9では、`001`で直接アドレス指定を示す。

Example

下の命令は

- opcode: `1100`
- register specifier: `0`
- addressing mode: `000`
- operand specifier: `0000 0000 0000 0000`